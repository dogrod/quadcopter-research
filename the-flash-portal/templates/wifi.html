{% extends "base.html" %}
{% block content %}
<h1>Wi-Fi Monitor</h1>
<div>
    <label for="display-filter">Display Filter:</label>
    <input type="text" id="display-filter" value="ip.addr == 192.168.4.3">
</div>
<button id="toggle-monitor">Start Wi-Fi Monitoring</button>
<div id="status"></div>
<table id="packets">
    <tr>
        <th>Source IP</th>
        <th>Destination IP</th>
        <th>Protocol</th>
        <th>Length</th>
    </tr>
</table>
<script>
    localStorage.debug = '*';

    var socket = io('/wifi', { transports: ['websocket'] });
    var monitoring = false;

    socket.on('connect', function() {
        console.log('Connected to Wi-Fi namespace');
    });

    socket.on('wifi_status', function(data) {
        console.log('Received wifi_status event:', data);
        monitoring = data.monitoring;
        updateButton();
    });

    socket.on('wifi_packet', function(data) {
        console.log('Received wifi_packet event:', data);
        var table = document.getElementById('packets');
        var row = table.insertRow(1);
        row.insertCell(0).innerHTML = data.source_ip;
        row.insertCell(1).innerHTML = data.destination_ip;
        row.insertCell(2).innerHTML = data.protocol;
        row.insertCell(3).innerHTML = data.length;
    });

    document.getElementById('toggle-monitor').addEventListener('click', function() {
        var displayFilter = document.getElementById('display-filter').value;
        var xhr = new XMLHttpRequest();

        xhr.open('POST', '{{ url_for("toggle_wifi_monitor") }}', true);
        xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
        xhr.send(JSON.stringify({ 'display_filter': displayFilter }));
        monitoring = !monitoring;
        updateButton();
    });

    function updateButton() {
        var button = document.getElementById('toggle-monitor');
        button.textContent = monitoring ? 'Stop Wi-Fi Monitoring' : 'Start Wi-Fi Monitoring';
        document.getElementById('status').textContent = monitoring ? 'Monitoring...' : 'Not Monitoring';
    }
</script>
{% endblock %}
